%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Monitoring of the detector and its subsystems}

At run-time, the status of the detecotr is visualized by the system status tree.
The top page of the tree is shown in Figure~\ref{figure:mu2e_status_page}.

\begin{itemize}
\item
  one monitoring frontend per DAQ node, monitors the DTCs and the ARTDAQ processes.
  The frontend is responsible for setting status of the ROCs, boardreaders, and such.
  THe same frontend propagates the error status up the subdetector tree. 
  \item
  monitoring GUI - displays status of the detector. MIDAS-based javascript+HTML.
  Each element of the detector system, as described in ODB, in addition to other parameters
  has two mandatory ones: ``Enabled'' and ``Status''.
  \begin{itemize}
  \item 
    Setting Enabled=0 excludes the element from the configuration, in which case it will be
    shown in gray.
  \item
    Enabled=1 will result in the element shown in green (Status >= 0) or red (Status< 0) 
  \end{itemize}
\end{itemize}

\begin{figure}[H]
  \begin{tikzpicture}
    \node[anchor=south west,inner sep=0] at (0,0.) {
      % \node[shift={(0 cm,0.cm)},inner sep=0,rotate={90}] at (0,0) {}
      \makebox[\textwidth][c] {
        \includegraphics[width=0.95\textwidth]{png/mu2e_status_page}
      }
    };
    % \node [text width=8cm, scale=1.0] at (14.5,0.5) {$\mu_B$, expected background mean};
    % \node [text width=8cm, scale=1.0, rotate={90}] at (1.5,7.5) { $S_{D}$, ``discovery'' signal strength  };
  \end{tikzpicture}
  \caption{
    \label{figure:mu2e_status_page}
    Mu2e status page (prototype)
  }
\end{figure}

State of each enabled configurable element is monitored by a MIDAS frontend.
If a problem is detected, the status of the element is set to a negative
number, which value represents the status code of the problem.

A special configuration frontend propagates the status of the problem up the
configuration tree in ODB. For example, if a problem is detected with one of the
tracker panels, the status box corresponding to the tracker on the top monitoring
page will also become red.

Figure~\ref{figure:daq_status} shows the prototype of the DAQ monitoring page.
The screenshot has been takes after the end of one of the test runs.
One of the mu2edaq22 boardreaders is ``in the red'' because one the ROCs it
was reading timed out.

\begin{figure}[H]
  \begin{tikzpicture}
    \node[anchor=south west,inner sep=0] at (0,0.) {
      % \node[shift={(0 cm,0.cm)},inner sep=0,rotate={90}] at (0,0) {}
      \makebox[\textwidth][c] {
        \includegraphics[width=0.95\textwidth]{png/daq_status}
      }
    };
    % \node [text width=8cm, scale=1.0] at (14.5,0.5) {$\mu_B$, expected background mean};
    % \node [text width=8cm, scale=1.0, rotate={90}] at (1.5,7.5) { $S_{D}$, ``discovery'' signal strength  };
  \end{tikzpicture}
  \caption{
    \label{figure:daq_status}
    Prototype of the DAQ status page
  }
\end{figure}

After a problem with the ROC is cleared, and the readout resumes, the boardreader status
is set to zero by the monitoring frontend, and the color of the corresponding box changes to green.
The change is propagated up the configuration tree by the configuration frontend,
and the color of the DAQ monitoring box becomes green again.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Interaction with the hardware}

Interaction with the hardware is handled by the node frontends.

If manual interaction is required, a click on the DTC button on the DAQ monitoring
page shown in Figure~\ref{figure:daq_status} opens a DTC control page, prototype of which
is shown in  Figure~\ref{figure:dtc_control_page}. Parameters of the commands to be executed
are stored of ODB in the "/Mu2e/Commands" subtree and could be set interactively
via either a web-based interface or {\bf odbedit}. 

\begin{figure}[H]
  \begin{tikzpicture}
    \node[anchor=south west,inner sep=0] at (0,0.) {
      % \node[shift={(0 cm,0.cm)},inner sep=0,rotate={90}] at (0,0) {}
      \makebox[\textwidth][c] {
        \includegraphics[width=0.95\textwidth]{png/dtc_control_page}
      }
    };
    % \node [text width=8cm, scale=1.0] at (14.5,0.5) {$\mu_B$, expected background mean};
    % \node [text width=8cm, scale=1.0, rotate={90}] at (1.5,7.5) { $S_{D}$, ``discovery'' signal strength  };
  \end{tikzpicture}
  \caption{
    \label{figure:dtc_control_page}
    Prototype of the DTC control page
  }
\end{figure}
%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
