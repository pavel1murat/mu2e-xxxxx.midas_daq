% -*- mode:flyspell; mode:latex -*-
\documentclass[12pt]{article}
\addtolength{\oddsidemargin} {-0.885in}
\addtolength{\textwidth}{1.75in}
\addtolength{\evensidemargin}{-0.8in}


\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{graphicx}
\usepackage{float}
%% \usepackage{siunitx}

%% \usepackage{gensymb}


\usepackage{tikz}
\usepackage{[caption}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations.markings}
\usetikzlibrary{decorations.pathmorphing}
% \usepackage[absolute,overlay]{textpos}
% \usepackage{onimage}

\usepackage{tabularx}
\usepackage{times}
\usepackage{graphics}

% \usepackage{subfigure}
% \usepackage{scalefnt}
%
% \renewcommand\thesubfigure{\arabic{subfigure}}

\usepackage{amsmath}
\usepackage{hyperref}
\usepackage{hhline}
\usepackage{subfig}
\usepackage{color}
\usepackage[all]{hypcap}

\usepackage[normalem]{ulem}  % for striking out
\usepackage{soul}
% \usepackage{fancyhdr}
% \pagestyle{fancy}
% \fancyhead[C]{}
% \fancyhead[L] {\it{Mu2e-doc-29670-v1.0} }
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% use natbib - biblatex not available on Mu2e interactive nodes
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[square,sort,comma,numbers]{natbib}

% location of the .bib files: env var BIBINPUTS (~/library/bibliography)

% \usepackage[backend=biber, style=numeric-comp, sorting=ynt] {biblatex}
% \addbibresource{clfv.bib}

% \addbibresource{stntuple.bib}
% \addbibresource{mu2e_web.bib}
% \addbibresource{radiative_pion_capture.bib}

\graphicspath{{figures/}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% for portability, make sure all commands are included locally,
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\definecolor{ForestGreen}{RGB}{20,109,20}
\include{local_commands}
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% for editors
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand {\pasha}[1]     {{\green  #1}}
\newcommand {\simon}[1]     {{\blue   #1}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\begin{titlepage}
  \begin{flushright}
    \bf {MU2E/PHYSICS/50071} \\
    version 1.02
    \today
 \end{flushright}

  \vspace{1cm}

  \begin{center}
    {\Large \bf MIDAS+ARTDAQ-based data acquisition system for Mu2e
      \vspace{0.3in}
    }

    \vspace{1cm}
    S.Corrodi(ANL), P.Murat(FNAL), ...

    % \footnote{\texttt{Fermilab; e-mail: murat@fnal.gov}}
    \vspace{0.3cm}

    \vspace{0.8cm}
  \end{center}

  \begin{abstract}
    \vspace{0.2in}

    This document describes a solution for the Mu2e data acquisition
    system based on MIDAS+ARTDAQ {\red need a name? }.

    It has been prototyped and tested by several Mu2e
    detector groups. 

    We propose to exercise this solution and demonstrate
    its functionality in the upcoming GR4.
  \end{abstract}

\end{titlepage}
% \frontmatter
% \chapter*{Abstract}
%
% \addcontentsline{toc}{chapter}{Abstract}
%
% \mainmatter
%
{\tableofcontents}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\chapter{Calibration}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \input{input_data}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section {Revision History and TODO items}

\begin{itemize}
\item
  v1.01: version for internal review
\end{itemize}

% {\red
% TODO items:
% 
% \begin{itemize}
% \item
% \end{itemize}
% }
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section {Introduction}

During the data taking, the DAQ system of the experiment has to be functional 24x7.
The Mu2e DAQ development effort was lagging quite significantly, and although some
progress has been made, after years of trying no Mu2e collaborator can operate
the DAQ system in their own. With a few months left before the start of the cosmic run,
the system has missing pieces yet to be designed.

The core of the DAQ system, OTSDAQ, has not been used before by any running experiment.
In is complicated and undocumented. The interfaces between different parts are not
specified, and complexity and the lack of modularity create a high threshold
for the Mu2e collaborators to start contributing. Most of the DAQ development
is happening outside the collaboration, and the collaboration has very a limited
input into the development process.

In our view, it will be very difficult for the collaboration to operate and support
the present system during he data taking.

We have therefore developed and prototyped a DAQ system based on ARTDAQ and MIDAS.

ARTDAQ is a software for a trigger farm developed at Fermilab and previously used
by several Fermilab neutrino experiments. 

MIDAS is a full DAQ suite which has been used for about 30 years
by many experiments at PSI, TRIUMF, CERN, KEK, and also g-2 experiment
at Fermilab. Out of running experiments, MIDAS is currently used by MEG-II.
Another CLFV experiment at PSI, Mu3e, which DAQ hardware architecture
is rather close to that of Mu2e, will also be using a MIDAS-based DAQ system.
In a way, it is a de-facto standard for experiments with low energy muon beams.

Any DAQ system initially has many issues which can only be uncovered and fixed
during operations. MIDAS has been tuned and debugged by decades of its use by
running experiments. Its architecture and the underlying software technologies
have evolved with time and currently

New collaborators joining Mu2e will likely know MIDAS.

Based on our technical assessment, a MIDAQ + ARTDAQ combination provides
the best solution for the Mu2e DAQ.

The following sections describe the architecture of the proposed system,
its parts, interfaces between them, the status of the present implementation.

\include{system_architecture}
\include{mu2e_configuration}
% \include{artdaq_interface}
\include{runtime_diagnostics}
\include{operation}
\include{support}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section {Summary}

\begin{itemize}
\item 
  The MIDAS+ARTDAQ solution for the Mu2e DAQ has been extensively prototyped.
\item
  the solution is significantly simpler for both the users and the developers
\item
  its current functionality, in many respects, already exceeds that
  of the OTSDAQ-based system  
\item
  collaboration members, including students, are contributing
  to the development process. 
\item
  new collaboration members joining Mu2e from other muon experiment will
  likely have an experience of operating a MIDAS-based DAQ
\end{itemize}

Based on our assessment, a combination of MIDAQ and  ARTDAQ
provides the best solution for the Mu2e DAQ.

We therefore propose to exercise this solution and demonstrate
its functionality in the upcoming GR4.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\bibliographystyle{unsrtnat}
\bibliography{clfv,mu2e_internal_notes,daq}

% \include{appendix_a}
\include{appendix_b}

\end{document}
